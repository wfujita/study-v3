# ステージFの補充について

レベル別の出題は、`app/static/index.html` に実装されている `buildOrderFromBank()` のロジックに基づいています。この処理では、まずステージ進捗（`StageTracker`）の情報を参照し、ステージFの問題だけで必要数を満たせない場合に、レベルの高い問題から不足分を埋める "Lv優先" の補充候補を作成します。

この補充候補に選ばれた問題は、そのセット内に限りステージFとして扱うように上書きされます。具体的には、補充対象の問題ID（または語彙キー）を `fallbackStageOverrides` に登録し、同じセッション中は StageTracker から返された元のステージ（例: C や D）ではなく、ステージFの在庫として優先的に採用されます。これにより、**Lv1 の在庫が不足したときでも Lv2 以降の問題をステージFの追加分として出題することが可能になりました。**

なお、この処理はフロントエンド側の出題順制御に限定されます。バックエンドの `StageTracker`（`app/stage_tracker.py`）が保持する正式なステージ履歴は変更されません。学習記録を完全にリセットしたい場合は、従来どおり履歴の削除や再構築を行ってください。

## 関連箇所
- `app/static/index.html` — ステージ別出題のデッキ組み立てと補充ステージの上書き処理。
- `app/stage_tracker.py` — ステージ遷移（昇格・リセット）を管理するバックエンド。
